<!doctype html>
<html lang="en">

<head>
    <title>{% block title %}{% endblock %} - Fitness Finder</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <div id="background-image"></div>
    <div class="full-body-container">
        <div class="top-text">
            <h1 class="main-title">Workout.ai</h1>
            <h2 class="sub-title">Get the right workout for your gear and goals.</h2>

            <!-- Search box -->
            <div class="input-box">
                <input placeholder="What exercise are you looking for?" id="filter-text-val">
                <button id="search-button" onclick="filterText()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="filter-row-container">
                <div class="filter-box">
                    <p class="filter-label">Equipment</p>
                    <div class="filter-group" id="equipment-filters">
                        <button class="filter-btn active" data-type="equipment" data-value="">All</button>
                        <button class="filter-btn" data-type="equipment" data-value="Dumbbell">Dumbbell</button>
                        <button class="filter-btn" data-type="equipment" data-value="Barbell">Barbell</button>
                        <button class="filter-btn" data-type="equipment" data-value="Cable">Cable</button>
                        <button class="filter-btn" data-type="equipment" data-value="Dumbell">Dumbell</button>
                        <button class="filter-btn" data-type="equipment" data-value="Exercise Ball">Exercise
                            Ball</button>
                        <button class="filter-btn" data-type="equipment" data-value="Foam Roll">Foam Roll</button>
                        <button class="filter-btn" data-type="equipment" data-value="Kettlebells">Kettlebells</button>
                        <button class="filter-btn" data-type="equipment" data-value="Machine">Machine</button>
                        <button class="filter-btn" data-type="equipment" data-value="None">None</button>
                        <button class="filter-btn" data-type="equipment" data-value="Other">Other</button>
                    </div>
                </div>

                <div class="filter-box">
                    <p class="filter-label">Target</p>
                    <div class="filter-group" id="bodypart-filters">
                        <button class="filter-btn active" data-type="bodypart" data-value="">All</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Abdominals">Abdominals</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Abductors">Abductors</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Adductors">Adductors</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Biceps">Biceps</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Calves">Calves</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Chest">Chest</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Forearms">Forearms</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Glutes">Glutes</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Hamstrings">Hamstrings</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Lats">Lats</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Lower Back">Lower Back</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Middle Back">Middle Back</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Quadriceps">Quadriceps</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Shoulders">Shoulders</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Traps">Traps</button>
                        <button class="filter-btn" data-type="bodypart" data-value="Triceps">Triceps</button>
                    </div>
                </div>
            </div>

            <!-- Results box -->
            <div id="answer-box">
                {% for exercise in exercises %}
                {% set e = exercise %}
                {% include 'exercise_detail.html' %}
                {% endfor %}
            </div>
        </div>

        <!-- <div class="left-icon">
        <img src="static/images/gym.png" alt="Workout Icon" />
    </div> -->

        <script>
            function goToExercise(url) {
                document.getElementById("loading-spinner").style.display = "block";
                setTimeout(() => {
                    window.location.href = url;
                }, 100);
            }

            function expandCard(card) {
                document.querySelectorAll('.card-expanded').forEach(expanded => {
                    expanded.style.display = 'none';
                    if (expanded.previousElementSibling) {
                        expanded.previousElementSibling.style.display = 'block';
                    }
                });

                card.style.display = "none";
                const expanded = card.nextElementSibling;
                expanded.style.display = "block";
                expanded.style.opacity = 0;

                const title = card.querySelector(".exercise-title").innerText;

                const videoElem = expanded.querySelector(".video-link");
                if (videoElem) {
                    fetch(`/video/${encodeURIComponent(title)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.Video) {
                                videoElem.innerHTML = `<a href="${data.Video}" target="_blank">Watch on YouTube</a>`;
                            } else {
                                videoElem.textContent = "N/A";
                            }
                        })
                        .catch(() => {
                            videoElem.textContent = "N/A";
                        });
                }

                requestAnimationFrame(() => {
                    expanded.style.opacity = 1;
                });
            }



            function closeCard(btn) {
                const expanded = btn.parentElement;
                expanded.style.display = "none";
                expanded.previousElementSibling.style.display = "block";
            }

            document.addEventListener("DOMContentLoaded", function () {
                let selectedEquipment = "";
                let selectedBodypart = "";
                let lastScrollTop = 0;

                function answerBoxTemplate(row) {
                    return `
    <div class='exercise-card'>
        <div class='card-front' onclick="expandCard(this)">
            <h3 class='exercise-title'>${row.Title}</h3>
            <p class='exercise-desc'>${row.Desc}</p>
            <p><strong>Rating:</strong> ${row.Rating === null ? 'N/A' : row.Rating}</p>
        </div>
        <div class='card-expanded'>
            <button class='close-btn' onclick="closeCard(this)">Ã—</button>
            <p><strong>Description:</strong> ${row.Desc}</p>
            <p><strong><i class="fas fa-dumbbell"></i> Muscle Group:</strong> ${row.BodyPart}</p>
            <p><strong><i class="fas fa-cogs"></i> Equipment:</strong> ${row.Equipment}</p>
            <p><strong><i class="fas fa-signal"></i> Level:</strong> ${row.Level}</p>
            <p><strong><i class="fas fa-star"></i> Rating:</strong> ${row.Rating}</p>
            <p><strong><i class="fab fa-youtube"></i> Video:</strong> <span class="video-link">Loading...</span></p>

        </div>
    </div>`;
                }

                function filterText() {
                    document.getElementById("answer-box").innerHTML = "";

                    let query = document.getElementById("filter-text-val").value;

                    let params = { title: query };
                    if (selectedEquipment) params.equipment = selectedEquipment;
                    if (selectedBodypart) params.bodypart = selectedBodypart;

                    fetch("/exercises?" + new URLSearchParams(params).toString())
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            const answerBox = document.getElementById("answer-box");
                            answerBox.innerHTML = "";

                            if (data.length === 0) {
                                const noResultsMessage = document.createElement("div");
                                noResultsMessage.classList.add("no-results");
                                noResultsMessage.textContent = "No workouts found. Try another search.";
                                answerBox.appendChild(noResultsMessage);
                                return;
                            }

                            data.forEach(row => {
                                const tempDiv = document.createElement("div");
                                tempDiv.innerHTML = answerBoxTemplate(row);
                                answerBox.appendChild(tempDiv);
                            });
                        });
                }

                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const type = btn.dataset.type;
                        const value = btn.dataset.value;

                        document.querySelectorAll(`.filter-btn[data-type="${type}"]`)
                            .forEach(b => b.classList.remove('active'));

                        btn.classList.add('active');

                        if (type === "equipment") selectedEquipment = value;
                        if (type === "bodypart") selectedBodypart = value;
                    });
                });

                document.getElementById("filter-text-val").addEventListener("keypress", function (event) {
                    if (event.key === "Enter") {
                        filterText();
                    }
                });

                document.getElementById("search-button").addEventListener("click", filterText);

                window.addEventListener("pageshow", function () {
                    document.getElementById("loading-spinner").style.display = "none";
                });

                window.addEventListener("load", function () {
                    document.getElementById("loading-spinner").style.display = "none";
                });
            });

            document.addEventListener("DOMContentLoaded", function () {
                let scrollOffset = 0;
                const runner = document.getElementById("runner");
            });
        </script>

        <div id="loading-spinner">
            <div class="spinner-circle"></div>
        </div>

</body>

</html>